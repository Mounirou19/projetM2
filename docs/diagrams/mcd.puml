@startuml MCD - CinéManga

!theme aws-orange
title Modèle Conceptuel de Données - CinéManga

' Entités
entity "UTILISATEUR" as user {
    * id : INTEGER
    --
    * nom : VARCHAR(255)
    * prenom : VARCHAR(255)
    * email : VARCHAR(255) {unique}
    * mot_de_passe : VARCHAR(255)
    * role : VARCHAR(255)
    * statut : BOOLEAN
}

entity "MEDIA" as media {
    * id : INTEGER
    --
    * titre : VARCHAR(255)
    * type : VARCHAR(255)
    * url_image : VARCHAR(255)
    description : TEXT
    * statut : BOOLEAN
    * score : INTEGER
}

entity "PROFIL" as profil {
    * id : INTEGER
    --
    * id_utilisateur : INTEGER
    * id_media : INTEGER
}

entity "CONTACT" as contact {
    * id : INTEGER
    --
    * nom : VARCHAR(255)
    * email : VARCHAR(255)
    * sujet : VARCHAR(255)
    * message : TEXT
    * date_creation : DATETIME
    * statut : BOOLEAN
}

entity "GENRE" as genre {
    * id : INTEGER
    --
    * nom : VARCHAR(255)
    * description : TEXT
}

entity "NOTATION" as notation {
    * id : INTEGER
    --
    * id_utilisateur : INTEGER
    * id_media : INTEGER
    * note : INTEGER
    * commentaire : TEXT
    * date_notation : DATETIME
}

entity "CATEGORIE" as categorie {
    * id : INTEGER
    --
    * nom : VARCHAR(255)
    * description : TEXT
    * type_media : VARCHAR(255)
}

' Relations
user ||--o{ profil : "possède"
media ||--o{ profil : "dans liste"
user ||--o{ notation : "note"
media ||--o{ notation : "reçoit note"
media }o--o{ genre : "appartient à"
media }o--|| categorie : "classé dans"

' Contraintes et règles métier
note top of user
  CONTRAINTES:
  - email unique
  - mot_de_passe haché (bcrypt)
  - role ∈ {ROLE_USER, ROLE_ADMIN}
  - statut: true=actif, false=suspendu
end note

note top of media
  CONTRAINTES:
  - type ∈ {film, serie, manga}
  - score: moyenne des notations utilisateurs
  - statut: true=publié, false=brouillon
  - titre unique par type
end note

note right of profil
  CONTRAINTES:
  - Relation many-to-many Users/Medias
  - Un utilisateur peut avoir un média
    une seule fois dans ses favoris
  - Suppression en cascade si User supprimé
end note

note bottom of notation
  CONTRAINTES:
  - note ∈ [1..10]
  - Un utilisateur ne peut noter
    qu'une seule fois le même média
  - date_notation auto-générée
end note

note left of contact
  CONTRAINTES:
  - Pas de relation avec Users
    (contact anonyme possible)
  - statut: true=non lu, false=traité
  - email format validé
end note

note top of genre
  EXEMPLES:
  - Action, Comédie, Drame, Horreur
  - Romance, Science-Fiction, Fantasy
  - Shonen, Seinen, Josei (pour mangas)
end note

note bottom of categorie
  EXEMPLES:
  - Nouveautés, Populaires, Classiques
  - En cours, Terminé, À venir
  - Spécifique par type de média
end note

' Règles de gestion
note as RG1
  <b>RÈGLES DE GESTION:</b>
  
  RG1: Un utilisateur peut ajouter plusieurs médias
       à ses favoris (relation 1:N)
  
  RG2: Un média peut être dans les favoris
       de plusieurs utilisateurs (relation N:1)
  
  RG3: Le score d'un média est calculé automatiquement
       comme la moyenne des notations
  
  RG4: Seuls les utilisateurs connectés peuvent
       noter et ajouter aux favoris
  
  RG5: Les administrateurs peuvent gérer tous
       les contenus et utilisateurs
  
  RG6: Les contacts peuvent être anonymes
       (pas de lien obligatoire avec Users)
  
  RG7: Un utilisateur suspendu (statut=false)
       ne peut plus se connecter
  
  RG8: Les médias non publiés (statut=false)
       ne sont visibles que par les admins
end note

@enduml
